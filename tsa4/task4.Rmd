---
title: "task4 - Цзян Чжэнхуа"
output: html_document
date: "2024-03-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## task4(Вариант13)

Сначала считайте данные из файла csv и преобразуйте их в форму временного ряда.

```{r}
setwd("C:\\Users\\lenovo\\Desktop\\时间序列分析\\tsa4")
dat <- read.csv("TrainingData.csv")
dat <- dat[complete.cases(dat), ]

# par(mfrow = c(1, 1), mar = c(5, 4, 4, 2) + 0.1)
x <- ts(dat$Значение,start = c(2017,1),frequency = 12)
x
```

Визуализация временных рядов

```{r}
plot(x)
```

### Проверить данные на стационарность.

```{r}
library(aTSA)
adf.test(x)
# white noise test
for(k in 1:2) print(Box.test(x,lag = 6*k))
```

На основании результатов ADF-теста и теста на белый шум можно сделать вывод, что ряд является гладким.


### К полученным данным идентифицировать и оценить две различных, но обоснованно возможных ARMA модели. 

Постройте графики автокорреляции и частичной автокорреляции последовательности
```{r}
acf(x,lag=36)
pacf(x,lag=36)
```

Как видно из графика временного ряда, в нем присутствует сезонный эффект с периодом 12.Ниже приводится предварительное определение порядка модели на основе графиков ACF и PACF:

#### Несезонный компонент

Для определения краткосрочной корреляционной модели для несезонной компоненты рассматриваются коэффициенты автокорреляции и коэффициенты частичной автокорреляции, характеризующие ряд до 12-го порядка.Как видно из рисунка, коэффициенты автокорреляции вплоть до 12-го порядка демонстрируют трейлинг. В то время как частичные коэффициенты автокорреляции демонстрируют усечение 1-го порядка, за исключением частичных коэффициентов автокорреляции 1-го порядка, которые находятся в диапазоне 2-кратного стандартного отклонения.

Поэтому в качестве модели несезонной компоненты была использована модель ARMA(1,0).

#### Сезонный компонент

Для характеристик сезонной автокорреляции исследуются коэффициенты автокорреляции и частичные коэффициенты автокорреляции по длине цикла для задержки 12-го порядка, 24-го порядка и т.д.

Графики коэффициента автокорреляции и частичного коэффициента автокорреляции значительно отличаются от нуля на 12-м порядке и близки или меньше, чем 2х-кратный диапазон стандартных отклонений на 24-м и 36-м порядках.

Поэтому сезонность можно охарактеризовать с помощью модели ARMA (0,1) или ARMA (1,1).

#### целостная модель

На основании полученных результатов были определены две возможные модели: SARMA(1,0,0)(0,0,1)(12) и SARMA(1,0,0)(1,0,1)(12).

### Оценка модели и выбрать из них наиболее адекватную

```{r}
library("lmtest")
x.fit <- arima(x,order = c(1,0,0),seasonal = list(order = c(0,0,1),period=12),method = "ML")
x.fit
coeftest(x.fit)
```

AIC_1 = 101.26

```{r}
library("lmtest")
x.fit1 <- arima(x,order = c(1,0,0),seasonal = list(order = c(1,0,1),period=12),method = "ML")
x.fit1
coeftest(x.fit1)
```

AIC_2 = 101.72

Согласно критерию AIC, модель SARMA(1,0,0)(0,0,1)(12) может быть признана более адекватной.
Таким образом, итоговая модель имеет параметры p=1,q=0,S=12,P=0,Q=1,d=0.

где

p - порядок не сезонной авторегрессии

q - порядок не сезонного  скользящего среднего

S - период сезонности

P - порядок  сезонной авторегрессии

Q - порядок  сезонного  скользящего среднего

d - порядок разности: 0 -не было разностей,  1- были разности

### Провести анализ остатков от удаления модели:тип вероятностного распределения,автокоррелированность остатков.

```{r}
residual <- x.fit$residuals
plot(residual ,type = "l", col = "blue",lwd = 2,main = "Residuals")
```

```{r}
Box.test(residual, lag = 16, type = "Ljung-Box", fitdf = 2)
```

Согласно полученному p-значению, автокорреляция в остатках отсутствует.

```{r}
acf(residual,lwd = 5,lag.max = 36, col = "blue")
pacf(residual,lwd = 5,lag.max = 36, col = "blue")
```

Как видно из графиков ACF и PACF, остатки не противоречат предположению о белом шуме.

```{r}
qqnorm(residual)
qqline(residual)

shapiro.test(residual)
```

Согласно графику qq и тесту Шапиро, остатки удовлетворяют нормальному распределению.

### Построить прогноз и доверительный интервал для прогноза уровня 0.95 на 12 интервалов времени вперед.

```{r}
library(forecast)
x.fore <- forecast(x.fit,h=12)
plot(x.fore,lty = 2)
lines(fitted(x.fit),col=4)
```

На рисунке выше пунктирная линия - это наблюдаемое значение ряда, сплошная линия - экспоненциально сглаженная оценка и прогноз ряда, темная заштрихованная часть - 80-процентный доверительный интервал прогноза, а светлая заштрихованная часть - 95-процентный доверительный интервал прогноза.

### Построить прогноз по модели (сезонной, если она есть) Holta-Winters на 12 интервалов времени вперед.

Поскольку присутствуют сезонные эффекты, использовалась трехпараметрическая модель экспоненциального сглаживания Holt-Winters.

```{r}
# Holt-Winter three-parameter exponential smoothing method
x.fit2 <- HoltWinters(x)
x.fit2
x.fore_holtwinter <- forecast(x.fit2,h=12)
plot(x.fore_holtwinter,lty = 2)
lines(x.fore_holtwinter$fitted ,col=4)
```

То же самое, что и раньше,пунктирная линия - это наблюдаемое значение ряда, сплошная линия - экспоненциально сглаженная оценка и прогноз ряда, темная заштрихованная часть - 80-процентный доверительный интервал прогноза, а светлая заштрихованная часть - 95-процентный доверительный интервал прогноза.


